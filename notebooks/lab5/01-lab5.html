<!DOCTYPE html>

<html lang="en" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Lab 5: Daisyworld &#8212; Numeric course 22.1 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=d75fae25" />
    <link rel="stylesheet" type="text/css" href="../../_static/mozilla.css?v=18700206" />
    <link rel="stylesheet" type="text/css" href="../../_static/nbsphinx-code-cells.css?v=2aa19091" />
    <script src="../../_static/documentation_options.js?v=f6d600a2"></script>
    <script src="../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="icon" href="../../_static/UBC_EOAS_favicon.ico"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Lab 6: The Lorenz equations" href="../lab6/01-lab6.html" />
    <link rel="prev" title="Solving Ordinary Differential Equations with the Runge-Kutta Methods" href="../lab4/01-lab4.html" /> 
  </head><body>
<!-- remove Mozilla link tab from upper right corner of page -->


    <div class="document">
  <div class="documentwrapper">
    
    <div class="sphinxsidebar">
        <nav>
        <h2><a href="../../index.html">Numeric course</a></h2>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../ugradsyllabus.html">Undergrad Syllabus</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ugrad_schedule.html">Undergrad Detailed Schedule</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../gradsyllabus.html">Grad Syllabus</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../grad_schedule.html">Grad Detailed Schedule</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../texts.html">Optional texts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting_started.html">Getting started</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../notebook_toc.html">Labs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../rubrics.html">Rubrics</a></li>
</ul>

        </nav>
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>
    </div>
    <div class="bodywrapper">
      <div class="body">
        
  <section id="Lab-5:-Daisyworld">
<h1>Lab 5: Daisyworld<a class="headerlink" href="#Lab-5:-Daisyworld" title="Link to this heading">¶</a></h1>
<section id="List-of-Problems">
<h2>List of Problems<a class="headerlink" href="#List-of-Problems" title="Link to this heading">¶</a></h2>
<p>Problem Constant Growth: Daisyworld with a constant growth rate</p>
<p>Problem Coupling: Daisyworld of neutral daisies coupled to the temperature</p>
<p>Problem Conduction: Daisyworld steady states and the effect of the conduction parameter R</p>
<p>Problem Initial: Daisyworld steady states and initial conditions</p>
<p>Problem Temperature: Add temperature retrieval code</p>
<p>Problem Estimate: Compare the error estimate to the true error</p>
<p>Problem Adaptive: Adaptive Timestep Code</p>
<p>Problem Predators: Adding predators to Daisyworld</p>
</section>
<section id="Assignment">
<h2>Assignment<a class="headerlink" href="#Assignment" title="Link to this heading">¶</a></h2>
<p>See canvas site for which problems you should hand in. Your answers should all be within a jupyter notebook. Use subheadings to organise your notebook by question, and markdown cells to describe what you’ve done and to answer the questions You will be asked to upload:</p>
<ol class="arabic simple">
<li><p>a pdf of your jupyter notebook answering all questions</p></li>
<li><p>the jupyter notebook itself (ipynb file) - if you want to import your own module code, include that with the notebook in a zipfile</p></li>
</ol>
</section>
<section id="Objectives">
<h2>Objectives<a class="headerlink" href="#Objectives" title="Link to this heading">¶</a></h2>
<p>In this lab, you will use the tools you have learnt in the previous labs to explore a simple environmental model, <em>Daisyworld</em>, with the help of a Runge-Kutta method with adaptive stepsize control.</p>
<p>The goal is for you to gain some experience using a Runge-Kutta integrator and to see the advantages of applying error control to the algorithm. As well, you will discover the the possible insights one can get from studying numerical solutions of a physical model.</p>
<p>In particular you will be able to:</p>
<ul class="simple">
<li><p>explain how the daisies affect the climate in the daisy world model</p></li>
<li><p>define an adaptive step-size model</p></li>
<li><p>explain the reasons why an adaptive step-size model may be faster for a given accuracy</p></li>
<li><p>explain why white daisies (alone) can survive at a higher solar constant than black daisies</p></li>
<li><p>define hysteresis</p></li>
</ul>
</section>
<section id="Readings">
<h2>Readings<a class="headerlink" href="#Readings" title="Link to this heading">¶</a></h2>
<p>There is no required reading for this lab, beyond the contents of the lab itself. However, if you would like additional background on any of the following topics, then refer to the sections indicated below:</p>
<ul class="simple">
<li><p><strong>Daisy World:</strong></p>
<ul>
<li><p>The original article by <a class="reference external" href="http://ezproxy.library.ubc.ca/login?url=http://onlinelibrary.wiley.com/enhanced/doi/10.1111/j.1600-0889.1983.tb00031.x">Watson and Lovelock, 1983</a> which derive the equations used here.</p></li>
<li><p>A 2008 Reviews of Geophysics article by <a class="reference external" href="http://ezproxy.library.ubc.ca/login?url=http://doi.wiley.com/10.1029/2006RG000217">Wood et al.</a> with more recent developments (species competition, etc.)</p></li>
</ul>
</li>
<li><p><strong>Runge-Kutta Methods with Adaptive Stepsize Control:</strong></p>
<ul>
<li><p>Newman, Section 8.4</p></li>
<li><p>Press, et al. Section 16.2: these are equations we implemented in Python, <a class="reference external" href="adapt_ode.pdf">scanned pdf here</a></p></li>
<li><p>Burden &amp; Faires Section 5.5</p></li>
</ul>
</li>
</ul>
</section>
<section id="Introduction">
<h2>Introduction<a class="headerlink" href="#Introduction" title="Link to this heading">¶</a></h2>
<p>It is obvious that life on earth is highly sensitive to the planet’s atmospheric and climatic conditions. What is less obvious, but of great interest, is the role biology plays in the sensitivity of the climate. This is dramatically illustrated by the concern over the possible contribution to global warming by the loss of the rain forests in Brazil, and shifts from forests to croplands over many regions of the Earth.</p>
<p>The fact that each may affect the other implies that the climate and life on earth are interlocked in a complex series of feedbacks, i.e. the climate affects the biosphere which, when altered, then changes the climate and so on. A fascinating question arises as to whether or not this would eventually lead to a stable climate. This scenerio is exploited to its fullest in the <em>Gaia</em> hypothesis which postulates that the biosphere, atmosphere, ocean and land are all part of some totality, dubbed
<em>Gaia</em>, which is essentially an elaborate feedback system which optimizes the conditions of life here on earth.</p>
<p>It would be hopeless to attempt to mathematically model such a large, complex system. What can be done instead is to construct a ’toy model’ of the system in which much of the complexity has been stripped away and only some of the relevant characteristics retained. The resulting system will then be tractable but, unfortunately, may bear little connection with the original physical system.</p>
<p>Daisyworld is such a model. Life on Daisyworld has been reduced to just two species of daisies of different colors. The only environmental condition that affects the daisy growth rate is temperature. The temperature in turn is modified by the varying amounts of radiation absorbed by the daisies.</p>
<p>Daisyworld is obviously a gross simplification of the real earth. However, it does retain the central feature of interest: a feedback loop between the climate and life on the planet. Since the equations governing the system will be correspondingly simplified, it will allow us to investigate under what conditions, if any, can equilibrium be reached. The hope is that this will then gain us some insight into how life on the real earth may lead to a stable (or unstable) climate.</p>
</section>
<section id="The-Daisyworld-Model">
<h2>The Daisyworld Model<a class="headerlink" href="#The-Daisyworld-Model" title="Link to this heading">¶</a></h2>
<p>Daisyworld is populated by two types of daisies, one darker than bare ground and the other lighter than bare ground. As with life on earth, the daisies will not grow at extreme temperatures and will have optimum growth at moderate temperatures.</p>
<p>The darker, ’black’ daisies absorb more radiation than the lighter, ’white’ daisies. If the black daisy population grows and spreads over more area, an increased amount of solar energy will be absorbed, which will ultimately raise the temperature of the planet. Conversely, an increase in the white daisy population will result in more radiation being reflected away, lowering the planet’s temperature.</p>
<p>The question to be answered is:</p>
<p><strong>Under what conditions, if any, will the daisy population and temperature reach equilibrium?</strong></p>
<section id="The-Daisy-Population">
<h3>The Daisy Population<a class="headerlink" href="#The-Daisy-Population" title="Link to this heading">¶</a></h3>
<p>The daisy population will be modeled along the lines of standard population ecology models where the net growth depends upon the current population. For example, the simplest model assumes the rate of growth is proportional to the population, i.e.</p>
<!-- \label{lab5:eq:exp} --><div class="math notranslate nohighlight">
\[\frac{dA_w}{dt} = k_w A_w\]</div>
<div class="math notranslate nohighlight">
\[\frac{dA_b}{dt} = k_b A_b\]</div>
<p>where <span class="math notranslate nohighlight">\(A_w\)</span> and <span class="math notranslate nohighlight">\(A_b\)</span> are fractions of the total planetary area covered by the white and black daisies, respectively, and <span class="math notranslate nohighlight">\(k_i\)</span>, <span class="math notranslate nohighlight">\(i=w,b\)</span>, are the white and black daisy growth rates per unit time, respectively. If assume the the growth rates <span class="math notranslate nohighlight">\(k_i\)</span> are (positive) constants we would have exponential growth like the bunny rabbits of lore.</p>
<p>We can make the model more realistic by letting the daisy birthrate depend on the amount of available land, i.e.</p>
<div class="math notranslate nohighlight">
\[k_i = \beta_i x\]</div>
<p>where <span class="math notranslate nohighlight">\(\beta_i\)</span> are the white and black daisy growth rates per unit time and area, respectively, and <span class="math notranslate nohighlight">\(x\)</span> is the fractional area of free fertile ground not colonized by either species. We can also add a daisy death rate per unit time, <span class="math notranslate nohighlight">\(\chi\)</span>, to get</p>
<!-- \label{lab5:eq:model} --><p><span class="math notranslate nohighlight">\(\textbf{eq: constantgrowth}\)</span></p>
<div class="math notranslate nohighlight">
\[\frac{dA_w}{dt} = A_w ( \beta_w x - \chi)\]</div>
<div class="math notranslate nohighlight">
\[\frac{dA_b}{dt} = A_b ( \beta_b x - \chi)\]</div>
<p>However, even these small modifications are non-trivial mathematically as the available fertile land is given by,</p>
<div class="math notranslate nohighlight">
\[x = 1 - A_w - A_b\]</div>
<p>(assuming all the land mass is fertile) which makes the equations non-linear.</p>
<div id="prob_constant"></div></section>
<section id="Problem-constant-growth">
<h3>Problem constant growth<a class="headerlink" href="#Problem-constant-growth" title="Link to this heading">¶</a></h3>
<!-- [lab5:prob:constant] --><p>Note that though the daisy growth rate per unit time depends on the amount of available fertile land, it is not otherwise coupled to the environment (i.e. <span class="math notranslate nohighlight">\(\beta_i\)</span> is not a function of temperature. Making the growth a function of bare ground, however, keeps the daisy population bounded and the daisy population will eventually reach some steady state. The next python cell has a script that runs a fixed timestep Runge Kutte routine that calculates area coverage of white and black daisies
for fixed growth rates <span class="math notranslate nohighlight">\(\beta_w\)</span> and <span class="math notranslate nohighlight">\(\beta_b\)</span>. Try changing these growth rates (specified in the derivs5 routine) and the initial white and black concentrations (specified in the fixed_growth.yaml file discussed next). To hand in: plot graphs to illustrate how these changes have affected the fractional coverage of black and white daisies over time compared to the original. Comment on the changes that you see.</p>
<ol class="arabic simple">
<li><p>For a given set of growth rates try various (non-zero) initial daisy populations.</p></li>
<li><p>For a given set of initial conditions try various growth rates. In particular, try rates that are both greater than and less than the death rate.</p></li>
<li><p>Can you determine when non-zero steady states are achieved? Explain. Connect what you see here with the discussion of hysteresis towards the end of this lab - what determines which steady state is reached?</p></li>
</ol>
<section id="Running-the-constant-growth-rate-demo">
<h4>Running the constant growth rate demo<a class="headerlink" href="#Running-the-constant-growth-rate-demo" title="Link to this heading">¶</a></h4>
<p>In the appendix we discuss the design of the integrator class and the adaptive Runge-Kutta routine. For this demo, we need to be able to change variables in the configuration file. For this assignment problem you are asked to:</p>
<ol class="loweralpha">
<li><p>Change the inital white and black daisy concentrations by changing these lines in the <a class="reference external" href="https://github.com/rhwhite/numeric_2022/blob/main/notebooks/lab5/fixed_growth.yaml#L13-L15">fixed_growth.yaml</a> input file (you can find this file in this lab directory):</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">initvars</span><span class="p">:</span>
<span class="w">   </span><span class="nt">whiteconc</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.2</span>
<span class="w">   </span><span class="nt">blackconc</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.7</span>
</pre></div>
</div>
</li>
<li><p>Change the white and black daisy growth rates by editing the variables beta_w and beta_b in the derivs5 routine in the next cell</p></li>
</ol>
<p>The Integrator class contains two different timeloops, both of which use embedded Runge Kutta Cash Carp code given in Lab 4 and coded here as <a class="reference external" href="https://github.com/rhwhite/numeric_2022/blob/main/numlabs/lab5/lab5_funs.py#L70">rkckODE5</a>. The simplest way to loop through the timesteps is just to call the integrator with a specified set of times. This is done in <a class="reference external" href="https://github.com/rhwhite/numeric_2022/blob/main/numlabs/lab5/lab5_funs.py#L244">timeloop5fixed</a>. Below we will describe how to use
the error extimates returned by rkckODE5 to tune the size of the timesteps, which is done in <a class="reference external" href="https://github.com/rhwhite/numeric_2022/blob/main/numlabs/lab5/lab5_funs.py#L244">timeloop5Err</a>.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#</span>
<span class="c1"># 4.1  integrate constant growth rates with fixed timesteps</span>
<span class="c1">#</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">context</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">numlabs.lab5.lab5_funs</span><span class="w"> </span><span class="kn">import</span> <span class="n">Integrator</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">collections</span><span class="w"> </span><span class="kn">import</span> <span class="n">namedtuple</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>


<span class="k">class</span><span class="w"> </span><span class="nc">Integ51</span><span class="p">(</span><span class="n">Integrator</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">set_yinit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1">#</span>
        <span class="c1"># read in &#39;albedo_white chi S0 L albedo_black R albedo_ground&#39;</span>
        <span class="c1">#</span>
        <span class="n">uservars</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s1">&#39;uservars&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;uservars&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">uservars</span> <span class="o">=</span> <span class="n">uservars</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;uservars&#39;</span><span class="p">])</span>
        <span class="c1">#</span>
        <span class="c1"># read in &#39;whiteconc blackconc&#39;</span>
        <span class="c1">#</span>
        <span class="n">initvars</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s1">&#39;initvars&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;initvars&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initvars</span> <span class="o">=</span> <span class="n">initvars</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;initvars&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">yinit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">initvars</span><span class="o">.</span><span class="n">whiteconc</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">initvars</span><span class="o">.</span><span class="n">blackconc</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nvars</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">yinit</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="c1">#</span>
    <span class="c1"># Construct an Integ51 class by inheriting first intializing</span>
    <span class="c1"># the parent Integrator class (called super).  Then do the extra</span>
    <span class="c1"># initialization in the set_yint function</span>
    <span class="c1">#</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">coeffFileName</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">coeffFileName</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_yinit</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">derivs5</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;y[0]=fraction white daisies</span>
<span class="sd">           y[1]=fraction black daisies</span>

<span class="sd">           Constant growty rates for white</span>
<span class="sd">           and black daisies beta_w and beta_b</span>

<span class="sd">           returns dy/dt</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">user</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">uservars</span>
        <span class="c1">#</span>
        <span class="c1"># bare ground</span>
        <span class="c1">#</span>
        <span class="n">x</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="c1"># growth rates don&#39;t depend on temperature</span>
        <span class="n">beta_b</span> <span class="o">=</span> <span class="mf">0.7</span>  <span class="c1"># growth rate for black daisies</span>
        <span class="n">beta_w</span> <span class="o">=</span> <span class="mf">0.7</span>  <span class="c1"># growth rate for white daisies</span>

        <span class="c1"># create a 1 x 2 element vector to hold the derivitive</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">nvars</span><span class="p">],</span> <span class="s1">&#39;float&#39;</span><span class="p">)</span>
        <span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">beta_w</span> <span class="o">*</span> <span class="n">x</span> <span class="o">-</span> <span class="n">user</span><span class="o">.</span><span class="n">chi</span><span class="p">)</span>
        <span class="n">f</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">beta_b</span> <span class="o">*</span> <span class="n">x</span> <span class="o">-</span> <span class="n">user</span><span class="o">.</span><span class="n">chi</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">f</span>


<span class="n">theSolver</span> <span class="o">=</span> <span class="n">Integ51</span><span class="p">(</span><span class="s1">&#39;fixed_growth.yaml&#39;</span><span class="p">)</span>
<span class="n">timeVals</span><span class="p">,</span> <span class="n">yVals</span><span class="p">,</span> <span class="n">errorList</span> <span class="o">=</span> <span class="n">theSolver</span><span class="o">.</span><span class="n">timeloop5fixed</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="s1">&#39;all&#39;</span><span class="p">)</span>
<span class="n">thefig</span><span class="p">,</span> <span class="n">theAx</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">theLines</span> <span class="o">=</span> <span class="n">theAx</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">timeVals</span><span class="p">,</span> <span class="n">yVals</span><span class="p">)</span>
<span class="n">theLines</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_marker</span><span class="p">(</span><span class="s1">&#39;+&#39;</span><span class="p">)</span>
<span class="n">theLines</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_linestyle</span><span class="p">(</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
<span class="n">theLines</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="n">theLines</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_marker</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">)</span>
<span class="n">theAx</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;lab 5 interactive 1  constant growth rate&#39;</span><span class="p">)</span>
<span class="n">theAx</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">)</span>
<span class="n">theAx</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;fractional coverage&#39;</span><span class="p">)</span>
<span class="n">theAx</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">theLines</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;white daisies&#39;</span><span class="p">,</span> <span class="s1">&#39;black daisies&#39;</span><span class="p">),</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">)</span>

<span class="n">thefig</span><span class="p">,</span> <span class="n">theAx</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">theLines</span> <span class="o">=</span> <span class="n">theAx</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">timeVals</span><span class="p">,</span> <span class="n">errorList</span><span class="p">)</span>
<span class="n">theLines</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_marker</span><span class="p">(</span><span class="s1">&#39;+&#39;</span><span class="p">)</span>
<span class="n">theLines</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_linestyle</span><span class="p">(</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
<span class="n">theLines</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="n">theLines</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_marker</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">)</span>
<span class="n">theAx</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;lab 5 interactive 1 errors&#39;</span><span class="p">)</span>
<span class="n">theAx</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">)</span>
<span class="n">theAx</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">)</span>
<span class="n">out</span> <span class="o">=</span> <span class="n">theAx</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">theLines</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;white errors&#39;</span><span class="p">,</span> <span class="s1">&#39;black errors&#39;</span><span class="p">),</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
</section>
<section id="The-Daisy-Growth-Rate---Coupling-to-the-Environment">
<h3>The Daisy Growth Rate - Coupling to the Environment<a class="headerlink" href="#The-Daisy-Growth-Rate---Coupling-to-the-Environment" title="Link to this heading">¶</a></h3>
<p>We now want to couple the Daisy growth rate to the climate, which we do by making the growth rate a function of the local temperature <span class="math notranslate nohighlight">\(T_i\)</span>,</p>
<div class="math notranslate nohighlight">
\[\beta_i = \beta_i(T_i)\]</div>
<p>The growth rate should drop to zero at extreme temperatures and be optimal at moderate temperatures. In Daisyworld this means the daisy population ceases to grow if the temperature drops below <span class="math notranslate nohighlight">\(5^o\)</span>C or goes above $40^o $C. The simplest model for the growth rate would then be parabolic function of temperature, peaking at <span class="math notranslate nohighlight">\(22.5^o\)</span>C:</p>
<!-- \label{lab5:eq:beta_i} --><div class="math notranslate nohighlight">
\[\beta_i = 1.0 - 0.003265(295.5 K - T_i)^2\]</div>
<p>where the <span class="math notranslate nohighlight">\(i\)</span> subscript denotes the type of daisy: grey (i=y), white (i=w) or black (i=b). (We’re reserving <span class="math notranslate nohighlight">\(\alpha_g\)</span> for the bare ground albedo)</p>
<p><img alt="ce1618eb2323423b8315a5a7a556bfd8" class="no-scaled-link" src="../../_images/beta.png" style="width: 40%;" /></p>
<p>Before specifying the local temperature, and its dependence on the daisy population, first consider the emission temperature <span class="math notranslate nohighlight">\(T_e\)</span>, which is the mean temperature of the planet,</p>
<!-- \label{lab5:eq:tempe} --><div class="math notranslate nohighlight">
\[T^4_e = L \frac{S_0}{4\sigma}(1-\alpha_p)\]</div>
<p>where <span class="math notranslate nohighlight">\(S_0\)</span> is a solar flux density constant, <span class="math notranslate nohighlight">\(L\)</span> is the fraction of <span class="math notranslate nohighlight">\(S_0\)</span> received at Daisyworld, and <span class="math notranslate nohighlight">\(\alpha_p\)</span> is the planetary albedo. The greater the planetary albedo <span class="math notranslate nohighlight">\(\alpha_p\)</span>, i.e. the more solar radiation the planet reflects, the lower the emission temperature.</p>
<p><strong>Mathematical note</strong>: The emission temperature is derived on the assumption that the planet is in global energy balance and is behaving as a blackbody radiator. See the appendix for more information.</p>
<div id="prob_coupling"></div></section>
<section id="Problem-Coupling">
<h3>Problem Coupling<a class="headerlink" href="#Problem-Coupling" title="Link to this heading">¶</a></h3>
<p>Consider daisies with the same albedo as the planet, i.e. ’grey’ or neutral daisies, as specified in derivs5 routine below.</p>
<ol class="arabic">
<li><p>For the current value of L (0.2) in the file coupling.yaml, the final daisy steady state is zero. Why is it zero?</p></li>
<li><p>Find a value of L which leads to a non-zero steady state.</p></li>
<li><p>What happens to the emission temperature as L is varied? Make a plot of <span class="math notranslate nohighlight">\(L\)</span> vs. <span class="math notranslate nohighlight">\(T_E\)</span> for 10-15 values of <span class="math notranslate nohighlight">\(L\)</span>. To do this, I overrode the value of L from the init file by passing a new value into the IntegCoupling constructor (see Appendix A). This allowed me to put</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">theSolver</span> <span class="o">=</span> <span class="n">IntegCoupling</span><span class="p">(</span><span class="s2">&quot;coupling.yaml&quot;</span><span class="p">,</span><span class="n">newL</span><span class="p">)</span>
<span class="n">timeVals</span><span class="p">,</span> <span class="n">yVals</span><span class="p">,</span> <span class="n">errorList</span> <span class="o">=</span> <span class="n">theSolver</span><span class="o">.</span><span class="n">timeloop5fixed</span><span class="p">()</span>
</pre></div>
</div>
<p>inside a loop that varied the L value and saved the steady state concentration for plotting</p>
</li>
</ol>
<p>After reading the the next section on the local temperature,</p>
<ol class="arabic simple" start="4">
<li><p>Do you see any difference between the daisy temperature and emission temperature? Plot both and explain. (Hint: I modified derivs5 to save these variables to self so I could compare their values at the end of the simulation. You could also override timeloop5fixed to do the same thing at each timestep.)</p></li>
<li><p>How (i.e. through what mechanism) does the makeup of the global daisy population affect the local temperature?</p></li>
</ol>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># define functions</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>


<span class="k">class</span><span class="w"> </span><span class="nc">IntegCoupling</span><span class="p">(</span><span class="n">Integrator</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;rewrite the init and derivs5 methods to</span>
<span class="sd">       work with a single (grey) daisy</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">set_yinit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1">#</span>
        <span class="c1"># read in &#39;albedo_grey chi S0 L  R albedo_ground&#39;</span>
        <span class="c1">#</span>
        <span class="n">uservars</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s1">&#39;uservars&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;uservars&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">uservars</span> <span class="o">=</span> <span class="n">uservars</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;uservars&#39;</span><span class="p">])</span>
        <span class="c1">#</span>
        <span class="c1"># read in &#39;greyconc&#39;</span>
        <span class="c1">#</span>
        <span class="n">initvars</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s1">&#39;initvars&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;initvars&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initvars</span> <span class="o">=</span> <span class="n">initvars</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;initvars&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">yinit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">initvars</span><span class="o">.</span><span class="n">greyconc</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nvars</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">yinit</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">coeffFileName</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">coeffFileName</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_yinit</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">derivs5</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">           Make the growth rate depend on the ground temperature</span>
<span class="sd">           using the quadratic function of temperature</span>

<span class="sd">           y[0]=fraction grey daisies</span>
<span class="sd">           t = time</span>
<span class="sd">           returns f[0] = dy/dt</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sigma</span> <span class="o">=</span> <span class="mf">5.67e-8</span>  <span class="c1"># Stefan Boltzman constant W/m^2/K^4</span>
        <span class="n">user</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">uservars</span>
        <span class="n">x</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">albedo_p</span> <span class="o">=</span> <span class="n">x</span> <span class="o">*</span> <span class="n">user</span><span class="o">.</span><span class="n">albedo_ground</span> <span class="o">+</span> <span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">user</span><span class="o">.</span><span class="n">albedo_grey</span>
        <span class="n">Te_4</span> <span class="o">=</span> <span class="n">user</span><span class="o">.</span><span class="n">S0</span> <span class="o">/</span> <span class="mf">4.0</span> <span class="o">*</span> <span class="n">user</span><span class="o">.</span><span class="n">L</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">albedo_p</span><span class="p">)</span> <span class="o">/</span> <span class="n">sigma</span>
        <span class="n">eta</span> <span class="o">=</span> <span class="n">user</span><span class="o">.</span><span class="n">R</span> <span class="o">*</span> <span class="n">user</span><span class="o">.</span><span class="n">L</span> <span class="o">*</span> <span class="n">user</span><span class="o">.</span><span class="n">S0</span> <span class="o">/</span> <span class="p">(</span><span class="mf">4.0</span> <span class="o">*</span> <span class="n">sigma</span><span class="p">)</span>
        <span class="n">temp_y</span> <span class="o">=</span> <span class="p">(</span><span class="n">eta</span> <span class="o">*</span> <span class="p">(</span><span class="n">albedo_p</span> <span class="o">-</span> <span class="n">user</span><span class="o">.</span><span class="n">albedo_grey</span><span class="p">)</span> <span class="o">+</span> <span class="n">Te_4</span><span class="p">)</span><span class="o">**</span><span class="mf">0.25</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">temp_y</span> <span class="o">&gt;=</span> <span class="mf">277.5</span> <span class="ow">and</span> <span class="n">temp_y</span> <span class="o">&lt;=</span> <span class="mf">312.5</span><span class="p">):</span>
            <span class="n">beta_y</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="mf">0.003265</span> <span class="o">*</span> <span class="p">(</span><span class="mf">295.0</span> <span class="o">-</span> <span class="n">temp_y</span><span class="p">)</span><span class="o">**</span><span class="mf">2.0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">beta_y</span> <span class="o">=</span> <span class="mf">0.0</span>

        <span class="c1"># create a 1 x 1 element vector to hold the derivative</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">nvars</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
        <span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">beta_y</span> <span class="o">*</span> <span class="n">x</span> <span class="o">-</span> <span class="n">user</span><span class="o">.</span><span class="n">chi</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">f</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Solve and plot for grey daisies</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>

<span class="n">theSolver</span> <span class="o">=</span> <span class="n">IntegCoupling</span><span class="p">(</span><span class="s1">&#39;coupling.yaml&#39;</span><span class="p">)</span>
<span class="n">timeVals</span><span class="p">,</span> <span class="n">yVals</span><span class="p">,</span> <span class="n">errorList</span> <span class="o">=</span> <span class="n">theSolver</span><span class="o">.</span><span class="n">timeloop5fixed</span><span class="p">()</span>

<span class="n">thefig</span><span class="p">,</span> <span class="n">theAx</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">theLines</span> <span class="o">=</span> <span class="n">theAx</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">timeVals</span><span class="p">,</span> <span class="n">yVals</span><span class="p">)</span>
<span class="n">theAx</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;lab 5: interactive 2 Coupling with grey daisies&#39;</span><span class="p">)</span>
<span class="n">theAx</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">)</span>
<span class="n">theAx</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;fractional coverage&#39;</span><span class="p">)</span>
<span class="n">out</span> <span class="o">=</span> <span class="n">theAx</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">theLines</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;grey daisies&#39;</span><span class="p">,</span> <span class="p">),</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
</section>
<section id="The-Local-Temperature---Dependence-on-Surface-Heat-Conductivity">
<h2>The Local Temperature - Dependence on Surface Heat Conductivity<a class="headerlink" href="#The-Local-Temperature---Dependence-on-Surface-Heat-Conductivity" title="Link to this heading">¶</a></h2>
<p>If we now allow for black and white daisies, the local temperature will differ according to the albedo of the region. The regions with white daisies will tend to be cooler than the ground and the regions with black daisies will tend to be hotter. To determine what the temperature is locally, we need to decide how readily the planet surface thermalises, i.e. how easily large-scale weather patterns redistributes the surface heat.</p>
<ul>
<li><p>If there is perfect heat ‘conduction’ between the different regions of the planet then the local temperature will equal the mean temperature given by the emission temperature <span class="math notranslate nohighlight">\(T_e\)</span>.</p>
<!-- \label{lab5:eq:temp0} --><div class="math notranslate nohighlight">
\[T^4_i \equiv T^4_e = L \frac{S_0}{4\sigma}(1-\alpha_p)\]</div>
</li>
<li><p>If there is no conduction, or perfect ‘insulation’, between regions then the temperature will be the emission temperature due to the albedo of the local region.</p>
<!-- \label{lab5:eq:temp1} --><div class="math notranslate nohighlight">
\[T^4_i= L \frac{S_0}{4\sigma}(1-\alpha_i)\]</div>
<p>where <span class="math notranslate nohighlight">\(\alpha_i\)</span> indicates either <span class="math notranslate nohighlight">\(\alpha_g\)</span>, <span class="math notranslate nohighlight">\(\alpha_w\)</span> or <span class="math notranslate nohighlight">\(\alpha_b\)</span>.</p>
</li>
</ul>
<p>The local temperature can be chosen to lie between these two values,</p>
<!-- \label{lab5:eq:tempi} --><div class="math notranslate nohighlight">
\[T^4_i = R L \frac{S_0}{4\sigma}(\alpha_p-\alpha_i) + T^4_e\]</div>
<p>where <span class="math notranslate nohighlight">\(R\)</span> is a parameter that interpolates between the two extreme cases i.e. <span class="math notranslate nohighlight">\(R=0\)</span> means perfect conduction and <span class="math notranslate nohighlight">\(R=1\)</span> implies perfect insulation between regions.</p>
<div id="prob_conduction"><section id="Problem-Conduction">
<h3>Problem Conduction<a class="headerlink" href="#Problem-Conduction" title="Link to this heading">¶</a></h3>
<p>The conduction parameter R will determine the temperature differential between the bare ground and the regions with black or white daisies. The code in the next cell specifies the derivatives for this situation, removing the feedback between the daisies and the planetary albedo but introducint conduction. Use it to investigate these two questions:</p>
<ol class="arabic simple">
<li><p>Change the value of R and observe the effects on the daisy and emission temperature.</p></li>
<li><p>What are the effects on the daisy growth rate and the final steady states?</p></li>
</ol>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 5.2  keep the albedo constant at alpha_p and vary the conductivity R</span>
<span class="c1">#</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">numlabs.lab5.lab5_funs</span><span class="w"> </span><span class="kn">import</span> <span class="n">Integrator</span>


<span class="k">class</span><span class="w"> </span><span class="nc">Integ53</span><span class="p">(</span><span class="n">Integrator</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">set_yinit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1">#</span>
        <span class="c1"># read in &#39;albedo_white chi S0 L albedo_black R albedo_ground&#39;</span>
        <span class="c1">#</span>
        <span class="n">uservars</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s1">&#39;uservars&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;uservars&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">uservars</span> <span class="o">=</span> <span class="n">uservars</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;uservars&#39;</span><span class="p">])</span>
        <span class="c1">#</span>
        <span class="c1"># read in &#39;whiteconc blackconc&#39;</span>
        <span class="c1">#</span>
        <span class="n">initvars</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s1">&#39;initvars&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;initvars&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initvars</span> <span class="o">=</span> <span class="n">initvars</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;initvars&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">yinit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">initvars</span><span class="o">.</span><span class="n">whiteconc</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">initvars</span><span class="o">.</span><span class="n">blackconc</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nvars</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">yinit</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">coeffFileName</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">coeffFileName</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_yinit</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">derivs5</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;y[0]=fraction white daisies</span>
<span class="sd">           y[1]=fraction black daisies</span>
<span class="sd">           no feedback between daisies and</span>
<span class="sd">           albedo_p (set to ground albedo)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sigma</span> <span class="o">=</span> <span class="mf">5.67e-8</span>  <span class="c1"># Stefan Boltzman constant W/m^2/K^4</span>
        <span class="n">user</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">uservars</span>
        <span class="n">x</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="c1">#</span>
        <span class="c1"># hard wire the albedo to that of the ground -- no daisy feedback</span>
        <span class="c1">#</span>
        <span class="n">albedo_p</span> <span class="o">=</span> <span class="n">user</span><span class="o">.</span><span class="n">albedo_ground</span>
        <span class="n">Te_4</span> <span class="o">=</span> <span class="n">user</span><span class="o">.</span><span class="n">S0</span> <span class="o">/</span> <span class="mf">4.0</span> <span class="o">*</span> <span class="n">user</span><span class="o">.</span><span class="n">L</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">albedo_p</span><span class="p">)</span> <span class="o">/</span> <span class="n">sigma</span>
        <span class="n">eta</span> <span class="o">=</span> <span class="n">user</span><span class="o">.</span><span class="n">R</span> <span class="o">*</span> <span class="n">user</span><span class="o">.</span><span class="n">L</span> <span class="o">*</span> <span class="n">user</span><span class="o">.</span><span class="n">S0</span> <span class="o">/</span> <span class="p">(</span><span class="mf">4.0</span> <span class="o">*</span> <span class="n">sigma</span><span class="p">)</span>
        <span class="n">temp_b</span> <span class="o">=</span> <span class="p">(</span><span class="n">eta</span> <span class="o">*</span> <span class="p">(</span><span class="n">albedo_p</span> <span class="o">-</span> <span class="n">user</span><span class="o">.</span><span class="n">albedo_black</span><span class="p">)</span> <span class="o">+</span> <span class="n">Te_4</span><span class="p">)</span><span class="o">**</span><span class="mf">0.25</span>
        <span class="n">temp_w</span> <span class="o">=</span> <span class="p">(</span><span class="n">eta</span> <span class="o">*</span> <span class="p">(</span><span class="n">albedo_p</span> <span class="o">-</span> <span class="n">user</span><span class="o">.</span><span class="n">albedo_white</span><span class="p">)</span> <span class="o">+</span> <span class="n">Te_4</span><span class="p">)</span><span class="o">**</span><span class="mf">0.25</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">temp_b</span> <span class="o">&gt;=</span> <span class="mf">277.5</span> <span class="ow">and</span> <span class="n">temp_b</span> <span class="o">&lt;=</span> <span class="mf">312.5</span><span class="p">):</span>
            <span class="n">beta_b</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="mf">0.003265</span> <span class="o">*</span> <span class="p">(</span><span class="mf">295.0</span> <span class="o">-</span> <span class="n">temp_b</span><span class="p">)</span><span class="o">**</span><span class="mf">2.0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">beta_b</span> <span class="o">=</span> <span class="mf">0.0</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">temp_w</span> <span class="o">&gt;=</span> <span class="mf">277.5</span> <span class="ow">and</span> <span class="n">temp_w</span> <span class="o">&lt;=</span> <span class="mf">312.5</span><span class="p">):</span>
            <span class="n">beta_w</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="mf">0.003265</span> <span class="o">*</span> <span class="p">(</span><span class="mf">295.0</span> <span class="o">-</span> <span class="n">temp_w</span><span class="p">)</span><span class="o">**</span><span class="mf">2.0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">beta_w</span> <span class="o">=</span> <span class="mf">0.0</span>

        <span class="c1"># create a 1 x 2 element vector to hold the derivitive</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">nvars</span><span class="p">],</span> <span class="s1">&#39;float&#39;</span><span class="p">)</span>
        <span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">beta_w</span> <span class="o">*</span> <span class="n">x</span> <span class="o">-</span> <span class="n">user</span><span class="o">.</span><span class="n">chi</span><span class="p">)</span>
        <span class="n">f</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">beta_b</span> <span class="o">*</span> <span class="n">x</span> <span class="o">-</span> <span class="n">user</span><span class="o">.</span><span class="n">chi</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">f</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Solve and plot conduction problem</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>

<span class="n">theSolver</span> <span class="o">=</span> <span class="n">Integ53</span><span class="p">(</span><span class="s1">&#39;conduction.yaml&#39;</span><span class="p">)</span>
<span class="n">timeVals</span><span class="p">,</span> <span class="n">yVals</span><span class="p">,</span> <span class="n">errorList</span> <span class="o">=</span> <span class="n">theSolver</span><span class="o">.</span><span class="n">timeloop5fixed</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="s1">&#39;all&#39;</span><span class="p">)</span>
<span class="n">thefig</span><span class="p">,</span> <span class="n">theAx</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">theLines</span> <span class="o">=</span> <span class="n">theAx</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">timeVals</span><span class="p">,</span> <span class="n">yVals</span><span class="p">)</span>
<span class="n">theLines</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_linestyle</span><span class="p">(</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
<span class="n">theLines</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="n">theAx</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;lab 5 interactive 3 -- conduction problem&#39;</span><span class="p">)</span>
<span class="n">theAx</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">)</span>
<span class="n">theAx</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;fractional coverage&#39;</span><span class="p">)</span>
<span class="n">out</span> <span class="o">=</span> <span class="n">theAx</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">theLines</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;white daisies&#39;</span><span class="p">,</span> <span class="s1">&#39;black daisies&#39;</span><span class="p">),</span>
                   <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;center right&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
</section>
<section id="The-Feedback-Loop---Feedback-Through-the-Planetary-Albedo">
<h2>The Feedback Loop - Feedback Through the Planetary Albedo<a class="headerlink" href="#The-Feedback-Loop---Feedback-Through-the-Planetary-Albedo" title="Link to this heading">¶</a></h2>
<p>The amount of solar radiation the planet reflects will depend on the daisy population since the white daisies will reflect more radiation than the bare ground and the black daisies will reflect less. So a reasonable estimate of the planetary albedo <span class="math notranslate nohighlight">\(\alpha_p\)</span> is an average of the albedo’s of the white and black daisies and the bare ground, weighted by the amount of area covered by each, i.e.</p>
<!-- \label{lab5:eq:albedop} --><div class="math notranslate nohighlight">
\[\alpha_p = A_w\alpha_w + A_b\alpha_b + A_g\alpha_g\]</div>
<p>A greater population of white daisies will tend to increase planetary albedo and decrease the emission temperature, as is apparent from equation ([lab5:eq:tempe]), while the reverse is true for the black daisies.</p>
<p>To summarize: The daisy population is controlled by its growth rate <span class="math notranslate nohighlight">\(\beta_i\)</span> which is a function of the local temperature <span class="math notranslate nohighlight">\(T_i\)</span></p>
<div class="math notranslate nohighlight">
\[\beta_i = 1.0 - 0.003265(295.5 K -T_i)^2\]</div>
<p>If the conductivity <span class="math notranslate nohighlight">\(R\)</span> is nonzero, the local temperature is a function of planetary albedo <span class="math notranslate nohighlight">\(\alpha_p\)</span></p>
<div class="math notranslate nohighlight">
\[T_i = \left[ R L \frac{S_0}{4\sigma}(\alpha_p-\alpha_i)
  + T^4_e \right]^{\frac{1}{4}}\]</div>
<p>which is determined by the daisy population.</p>
<ul class="simple">
<li><p>Physically, this provides the feedback from the daisy population back to the temperature, completing the loop between the daisies and temperature.</p></li>
<li><p>Mathematically, this introduces a rather nasty non-linearity into the equations which, as pointed out in the lab 1, usually makes it difficult, if not impossible, to obtain exact analytic solutions.</p></li>
</ul>
<div id="prob_initial"></div><section id="Problem-Initial">
<h3>Problem Initial<a class="headerlink" href="#Problem-Initial" title="Link to this heading">¶</a></h3>
<p>The feedback means a stable daisy population (a steady state) and the environmental conditions are in a delicate balance. The code below produces a steady state which arises from a given initial daisy population that starts with only white daisies.</p>
<ol class="arabic simple">
<li><p>Add a relatively small (5%, blackconc = 0.05) initial fraction of black daisies to the value in initial.yaml and see what effect this has on the temperature and final daisy populations. Do you still have a final non-zero daisy population?</p></li>
<li><p>Set the initial black daisy population to 0.05 Attempt to adjust the initial white daisy population to obtain a non-zero steady state. What value of initial white daisy population gives you a non-zero steady state for blackconc=0.05? Do you have to increase or decrease the initial fraction? What is your explanation for this behavior?</p></li>
<li><p>Experiment with other initial fractions of daisies and look for non-zero steady states. Describe and explain your results. Connect what you see here with the discussion of hysteresis towards the end of this lab - what determines which steady state is reached?</p></li>
</ol>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># functions for problem initial</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">numlabs.lab5.lab5_funs</span><span class="w"> </span><span class="kn">import</span> <span class="n">Integrator</span>


<span class="k">class</span><span class="w"> </span><span class="nc">Integ54</span><span class="p">(</span><span class="n">Integrator</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">set_yinit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1">#</span>
        <span class="c1"># read in &#39;albedo_white chi S0 L albedo_black R albedo_ground&#39;</span>
        <span class="c1">#</span>
        <span class="n">uservars</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s1">&#39;uservars&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;uservars&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">uservars</span> <span class="o">=</span> <span class="n">uservars</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;uservars&#39;</span><span class="p">])</span>
        <span class="c1">#</span>
        <span class="c1"># read in &#39;whiteconc blackconc&#39;</span>
        <span class="c1">#</span>
        <span class="n">initvars</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s1">&#39;initvars&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;initvars&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initvars</span> <span class="o">=</span> <span class="n">initvars</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;initvars&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">yinit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">initvars</span><span class="o">.</span><span class="n">whiteconc</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">initvars</span><span class="o">.</span><span class="n">blackconc</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nvars</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">yinit</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">coeff_file_name</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">coeff_file_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_yinit</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">find_temp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">yvals</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Calculate the temperatures over the white and black daisies</span>
<span class="sd">            and the planetary equilibrium temperature given the daisy fractions</span>

<span class="sd">            input:  yvals -- array of dimension [2] with the white [0] and black [1]</span>
<span class="sd">                    daisy fractiion</span>
<span class="sd">            output:  white temperature (K), black temperature (K), equilibrium temperature (K)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sigma</span> <span class="o">=</span> <span class="mf">5.67e-8</span>  <span class="c1"># Stefan Boltzman constant W/m^2/K^4</span>
        <span class="n">user</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">uservars</span>
        <span class="n">bare</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="n">yvals</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">yvals</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">albedo_p</span> <span class="o">=</span> <span class="n">bare</span> <span class="o">*</span> <span class="n">user</span><span class="o">.</span><span class="n">albedo_ground</span> <span class="o">+</span> \
            <span class="n">yvals</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">user</span><span class="o">.</span><span class="n">albedo_white</span> <span class="o">+</span> <span class="n">yvals</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">user</span><span class="o">.</span><span class="n">albedo_black</span>
        <span class="n">Te_4</span> <span class="o">=</span> <span class="n">user</span><span class="o">.</span><span class="n">S0</span> <span class="o">/</span> <span class="mf">4.0</span> <span class="o">*</span> <span class="n">user</span><span class="o">.</span><span class="n">L</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">albedo_p</span><span class="p">)</span> <span class="o">/</span> <span class="n">sigma</span>
        <span class="n">temp_e</span> <span class="o">=</span> <span class="n">Te_4</span><span class="o">**</span><span class="mf">0.25</span>
        <span class="n">eta</span> <span class="o">=</span> <span class="n">user</span><span class="o">.</span><span class="n">R</span> <span class="o">*</span> <span class="n">user</span><span class="o">.</span><span class="n">L</span> <span class="o">*</span> <span class="n">user</span><span class="o">.</span><span class="n">S0</span> <span class="o">/</span> <span class="p">(</span><span class="mf">4.0</span> <span class="o">*</span> <span class="n">sigma</span><span class="p">)</span>
        <span class="n">temp_b</span> <span class="o">=</span> <span class="p">(</span><span class="n">eta</span> <span class="o">*</span> <span class="p">(</span><span class="n">albedo_p</span> <span class="o">-</span> <span class="n">user</span><span class="o">.</span><span class="n">albedo_black</span><span class="p">)</span> <span class="o">+</span> <span class="n">Te_4</span><span class="p">)</span><span class="o">**</span><span class="mf">0.25</span>
        <span class="n">temp_w</span> <span class="o">=</span> <span class="p">(</span><span class="n">eta</span> <span class="o">*</span> <span class="p">(</span><span class="n">albedo_p</span> <span class="o">-</span> <span class="n">user</span><span class="o">.</span><span class="n">albedo_white</span><span class="p">)</span> <span class="o">+</span> <span class="n">Te_4</span><span class="p">)</span><span class="o">**</span><span class="mf">0.25</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">temp_w</span><span class="p">,</span> <span class="n">temp_b</span><span class="p">,</span> <span class="n">temp_e</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">derivs5</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;y[0]=fraction white daisies</span>
<span class="sd">           y[1]=fraction black daisies</span>
<span class="sd">           no feedback between daisies and</span>
<span class="sd">           albedo_p (set to ground albedo)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">temp_w</span><span class="p">,</span> <span class="n">temp_b</span><span class="p">,</span> <span class="n">temp_e</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_temp</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">temp_b</span> <span class="o">&gt;=</span> <span class="mf">277.5</span> <span class="ow">and</span> <span class="n">temp_b</span> <span class="o">&lt;=</span> <span class="mf">312.5</span><span class="p">):</span>
            <span class="n">beta_b</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="mf">0.003265</span> <span class="o">*</span> <span class="p">(</span><span class="mf">295.0</span> <span class="o">-</span> <span class="n">temp_b</span><span class="p">)</span><span class="o">**</span><span class="mf">2.0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">beta_b</span> <span class="o">=</span> <span class="mf">0.0</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">temp_w</span> <span class="o">&gt;=</span> <span class="mf">277.5</span> <span class="ow">and</span> <span class="n">temp_w</span> <span class="o">&lt;=</span> <span class="mf">312.5</span><span class="p">):</span>
            <span class="n">beta_w</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="mf">0.003265</span> <span class="o">*</span> <span class="p">(</span><span class="mf">295.0</span> <span class="o">-</span> <span class="n">temp_w</span><span class="p">)</span><span class="o">**</span><span class="mf">2.0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">beta_w</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">user</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">uservars</span>
        <span class="n">bare</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="c1"># create a 1 x 2 element vector to hold the derivitive</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty_like</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
        <span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">beta_w</span> <span class="o">*</span> <span class="n">bare</span> <span class="o">-</span> <span class="n">user</span><span class="o">.</span><span class="n">chi</span><span class="p">)</span>
        <span class="n">f</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">beta_b</span> <span class="o">*</span> <span class="n">bare</span> <span class="o">-</span> <span class="n">user</span><span class="o">.</span><span class="n">chi</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">f</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Solve and plot for problem initial</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>

<span class="n">theSolver</span> <span class="o">=</span> <span class="n">Integ54</span><span class="p">(</span><span class="s1">&#39;initial.yaml&#39;</span><span class="p">)</span>
<span class="n">timevals</span><span class="p">,</span> <span class="n">yvals</span><span class="p">,</span> <span class="n">errorlist</span> <span class="o">=</span> <span class="n">theSolver</span><span class="o">.</span><span class="n">timeloop5fixed</span><span class="p">()</span>
<span class="n">daisies</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">yvals</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="s1">&#39;black&#39;</span><span class="p">])</span>

<span class="n">thefig</span><span class="p">,</span> <span class="n">theAx</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">line1</span><span class="p">,</span> <span class="o">=</span> <span class="n">theAx</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">timevals</span><span class="p">,</span> <span class="n">daisies</span><span class="p">[</span><span class="s1">&#39;white&#39;</span><span class="p">])</span>
<span class="n">line2</span><span class="p">,</span> <span class="o">=</span> <span class="n">theAx</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">timevals</span><span class="p">,</span> <span class="n">daisies</span><span class="p">[</span><span class="s1">&#39;black&#39;</span><span class="p">])</span>
<span class="n">line1</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">)</span>
<span class="n">line2</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
<span class="n">theAx</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;lab 5 interactive 4, initial conditions&#39;</span><span class="p">)</span>
<span class="n">theAx</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">)</span>
<span class="n">theAx</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;fractional coverage&#39;</span><span class="p">)</span>
<span class="n">out</span> <span class="o">=</span> <span class="n">theAx</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;center right&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div id="prob_temperature"></div></section>
<section id="Problem-Temperature">
<h3>Problem Temperature<a class="headerlink" href="#Problem-Temperature" title="Link to this heading">¶</a></h3>
<p>The code above in Problem Initial adds a new method, <code class="docutils literal notranslate"><span class="pre">find_temp</span></code> that takes the white/black daisy fractions and calculates local and planetary temperatures.</p>
<ol class="arabic simple">
<li><p>override <code class="docutils literal notranslate"><span class="pre">timeloop5fixed</span></code> so that it saves these three temperatures, plus the daisy growth rates to new variables in the Integ54 instance</p></li>
<li><p>Make plots of (temp_w, temp_b) and (beta_w, beta_b) vs. time for a case with non-zero equilibrium concentrations of both black and white daisies</p></li>
</ol>
</section>
</section>
<section id="Adaptive-Stepsize-in-Runge-Kutta">
<h2>Adaptive Stepsize in Runge-Kutta<a class="headerlink" href="#Adaptive-Stepsize-in-Runge-Kutta" title="Link to this heading">¶</a></h2>
<section id="Why-Adaptive-Stepsize?">
<h3>Why Adaptive Stepsize?<a class="headerlink" href="#Why-Adaptive-Stepsize?" title="Link to this heading">¶</a></h3>
<p>As a rule of thumb, accuracy increases in Runge-Kutta methods as stepsize decreases. At the same time, the number of function evaluations performed increases. This tradeoff between accuracy of the solution and computational cost always exists, but in the ODE solution algorithms presented earlier it often appears to be unnecessarily large. To see this, consider the solution to a problem in two different time intervals - in the first time interval, the solution is close to steady, whereas in the
second one it changes quickly. For acceptable accuracy with a non-adaptive method the step size will have to be adjusted so that the approximate solution is close to the actual solution in the second interval. The stepsize will be fairly small, so that the approximate solution is able to follow the changes in the solution here. However, as there is no change in stepsize throughout the solution process, the same step size will be applied to approximate the solution in the first time interval,
where clearly a much larger stepsize would suffice to achieve the same accuracy. Thus, in a region where the solution behaves nicely a lot of function evaluations are wasted because the stepsize is chosen in accordance with the most quickly changing part of the solution.</p>
<p>The way to address this problem is the use of adaptive stepsize control. This class of algorithms adjusts the stepsize taken in a time interval according to the properties of the solution in that interval, making it useful for producing a solution that has a given accuracy in the minimum number of steps.</p>
</section>
<section id="Designing-Adaptive-Stepsize-Control">
<h3>Designing Adaptive Stepsize Control<a class="headerlink" href="#Designing-Adaptive-Stepsize-Control" title="Link to this heading">¶</a></h3>
<p>Now that the goal is clear, the question remains of how to close in on it. As mentioned above, an adaptive algorithm is usually asked to solve a problem to a desired accuracy. To be able to adjust the stepsize in Runge-Kutta the algorithm must therefore calculate some estimate of how far its solution deviates from the actual solution. If with its initial stepsize this estimate is already well within the desired accuracy, the algorithm can proceed with a larger stepsize. If the error estimate is
larger than the desired accuracy, the algorithm decreases the stepsize at this point and attempts to take a smaller step. Calculating this error estimate will always increase the amount of work done at a step compared to non-adaptive methods. Thus, the remaining problem is to devise a method of calculating this error estimate that is both inexpensive and accurate.</p>
</section>
<section id="Error-Estimate-by-Step-Doubling">
<h3>Error Estimate by Step Doubling<a class="headerlink" href="#Error-Estimate-by-Step-Doubling" title="Link to this heading">¶</a></h3>
<p>The first and simple approach to arriving at an error estimate is to simply take every step twice. The second time the step is divided up into two steps, producing a different estimate of the solution. The difference in the two solutions can be used to produce an estimate of the truncation error for this step.</p>
<p>How expensive is this method to estimate the error? A single step of fourth order Runge-Kutta always takes four function evaluations. As the second time the step is taken in half-steps, it will take 8 evaluations. However, the first function evaluation in taking a step twice is identical to both steps, and thus the overall cost for one step with step doubling is <span class="math notranslate nohighlight">\(12 - 1 = 11\)</span> function evaluations. This should be compared to taking two normal half-steps as this corresponds to the overall
accuracy achieved. So we are looking at 3 function evaluations more per step, or an increase of computational cost by a factor of <span class="math notranslate nohighlight">\(1.375\)</span>.</p>
<p>Step doubling works in practice, but the next section presents a slicker way of arriving at an error estimate that is less computationally expensive. It is the commmonly used one today.</p>
</section>
<section id="Error-Estimate-using-Embedded-Runge-Kutta">
<h3>Error Estimate using Embedded Runge-Kutta<a class="headerlink" href="#Error-Estimate-using-Embedded-Runge-Kutta" title="Link to this heading">¶</a></h3>
<p>Another way of estimating the truncation error of a step is due to the existence of the special fifth-order Runge-Kutta methods discussed earlier. These methods use six function evaluations which can be recombined to produce a fourth-order method . Again, the difference between the fifth and the fourth order solution is used to calculate an estimate of the truncation error. Obviously this method requires fewer function evaluations than step doubling, as the two estimates use the same evaluation
points. Originally this method was found by Fehlberg, and later Cash and Karp produced the set of constants presented earlier that produce an efficient and accurate error estimate.</p>
<div id="prob_estimate"></div></section>
<section id="Problem-Estimate">
<h3>Problem Estimate<a class="headerlink" href="#Problem-Estimate" title="Link to this heading">¶</a></h3>
<p>In the demo below, compare the error estimate to the true error, on the initial value problem from Lab 4,</p>
<div class="math notranslate nohighlight">
\[\frac{dy}{dt} = -y +t +1,  \;\;\;\; y(0) =1\]</div>
<p>which has the exact solution</p>
<div class="math notranslate nohighlight">
\[y(t) = t + e^{-t}\]</div>
<ol class="arabic simple">
<li><p>Play with the time step and final time, attempting small changes at first. How reasonable is the error estimate?</p></li>
<li><p>Keep decreasing the time step. Does the error estimate diverge from the computed error? Why?</p></li>
<li><p>Keep increasing the time step. Does the error estimate diverge? What is happening with the numerical solution?</p></li>
</ol>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Functions for problem estimate</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">numlabs.lab5.lab5_funs</span><span class="w"> </span><span class="kn">import</span> <span class="n">Integrator</span>


<span class="k">class</span><span class="w"> </span><span class="nc">Integ55</span><span class="p">(</span><span class="n">Integrator</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">set_yinit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1">#</span>
        <span class="c1"># read in &#39;c1 c2 c3&#39;</span>
        <span class="c1">#</span>
        <span class="n">uservars</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s1">&#39;uservars&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;uservars&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">uservars</span> <span class="o">=</span> <span class="n">uservars</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;uservars&#39;</span><span class="p">])</span>
        <span class="c1">#</span>
        <span class="c1"># read in initial yinit</span>
        <span class="c1">#</span>
        <span class="n">initvars</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s1">&#39;initvars&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;initvars&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initvars</span> <span class="o">=</span> <span class="n">initvars</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;initvars&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">yinit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">initvars</span><span class="o">.</span><span class="n">yinit</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nvars</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">yinit</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">coeff_file_name</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">coeff_file_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_yinit</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">derivs5</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">theTime</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">           y[0]=fraction white daisies</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">user</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">uservars</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">yinit</span><span class="p">)</span>
        <span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">user</span><span class="o">.</span><span class="n">c1</span> <span class="o">*</span> <span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">user</span><span class="o">.</span><span class="n">c2</span> <span class="o">*</span> <span class="n">theTime</span> <span class="o">+</span> <span class="n">user</span><span class="o">.</span><span class="n">c3</span>
        <span class="k">return</span> <span class="n">f</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Solve and plot for problem estimate</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>

<span class="n">theSolver</span> <span class="o">=</span> <span class="n">Integ55</span><span class="p">(</span><span class="s1">&#39;expon.yaml&#39;</span><span class="p">)</span>

<span class="n">timeVals</span><span class="p">,</span> <span class="n">yVals</span><span class="p">,</span> <span class="n">yErrors</span> <span class="o">=</span> <span class="n">theSolver</span><span class="o">.</span><span class="n">timeloop5Err</span><span class="p">()</span>
<span class="n">timeVals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">timeVals</span><span class="p">)</span>
<span class="n">exact</span> <span class="o">=</span> <span class="n">timeVals</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">timeVals</span><span class="p">)</span>
<span class="n">yVals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">yVals</span><span class="p">)</span>
<span class="n">yVals</span> <span class="o">=</span> <span class="n">yVals</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
<span class="n">yErrors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">yErrors</span><span class="p">)</span>

<span class="n">thefig</span><span class="p">,</span> <span class="n">theAx</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">line1</span> <span class="o">=</span> <span class="n">theAx</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">timeVals</span><span class="p">,</span> <span class="n">yVals</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;adapt&#39;</span><span class="p">)</span>
<span class="n">line2</span> <span class="o">=</span> <span class="n">theAx</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">timeVals</span><span class="p">,</span> <span class="n">exact</span><span class="p">,</span> <span class="s1">&#39;r+&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;exact&#39;</span><span class="p">)</span>
<span class="n">theAx</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;lab 5 interactive 5&#39;</span><span class="p">)</span>
<span class="n">theAx</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">)</span>
<span class="n">theAx</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;y value&#39;</span><span class="p">)</span>
<span class="n">theAx</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;center right&#39;</span><span class="p">)</span>

<span class="c1">#</span>
<span class="c1"># we need to unpack yvals (a list of arrays of length 1</span>
<span class="c1"># into an array of numbers using a list comprehension</span>
<span class="c1">#</span>

<span class="n">thefig</span><span class="p">,</span> <span class="n">theAx</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">realestError</span> <span class="o">=</span> <span class="n">yVals</span> <span class="o">-</span> <span class="n">exact</span>
<span class="n">actualErrorLine</span> <span class="o">=</span> <span class="n">theAx</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">timeVals</span><span class="p">,</span> <span class="n">realestError</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;actual error&#39;</span><span class="p">)</span>
<span class="n">estimatedErrorLine</span> <span class="o">=</span> <span class="n">theAx</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">timeVals</span><span class="p">,</span> <span class="n">yErrors</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;estimated error&#39;</span><span class="p">)</span>
<span class="n">theAx</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">)</span>

<span class="n">timeVals</span><span class="p">,</span> <span class="n">yVals</span><span class="p">,</span> <span class="n">yErrors</span> <span class="o">=</span> <span class="n">theSolver</span><span class="o">.</span><span class="n">timeloop5fixed</span><span class="p">()</span>

<span class="n">np_yVals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">yVals</span><span class="p">)</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
<span class="n">yErrors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">yErrors</span><span class="p">)</span>
<span class="n">np_exact</span> <span class="o">=</span> <span class="n">timeVals</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">timeVals</span><span class="p">)</span>

<span class="n">thefig</span><span class="p">,</span> <span class="n">theAx</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">line1</span> <span class="o">=</span> <span class="n">theAx</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">timeVals</span><span class="p">,</span> <span class="n">np_yVals</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;fixed&#39;</span><span class="p">)</span>
<span class="n">line2</span> <span class="o">=</span> <span class="n">theAx</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">timeVals</span><span class="p">,</span> <span class="n">np_exact</span><span class="p">,</span> <span class="s1">&#39;r+&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;exact&#39;</span><span class="p">)</span>
<span class="n">theAx</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;lab 5 interactive 5 -- fixed&#39;</span><span class="p">)</span>
<span class="n">theAx</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">)</span>
<span class="n">theAx</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;y value&#39;</span><span class="p">)</span>
<span class="n">theAx</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;center right&#39;</span><span class="p">)</span>

<span class="n">thefig</span><span class="p">,</span> <span class="n">theAx</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">realestError</span> <span class="o">=</span> <span class="n">np_yVals</span> <span class="o">-</span> <span class="n">np_exact</span>
<span class="n">actualErrorLine</span> <span class="o">=</span> <span class="n">theAx</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">timeVals</span><span class="p">,</span> <span class="n">realestError</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;actual error&#39;</span><span class="p">)</span>
<span class="n">estimatedErrorLine</span> <span class="o">=</span> <span class="n">theAx</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">timeVals</span><span class="p">,</span> <span class="n">yErrors</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;estimated error&#39;</span><span class="p">)</span>
<span class="n">theAx</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">)</span>
<span class="n">theAx</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;lab 5 interactive 5 -- fixed errors&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
<section id="Using-Error-to-Adjust-the-Stepsize">
<h3>Using Error to Adjust the Stepsize<a class="headerlink" href="#Using-Error-to-Adjust-the-Stepsize" title="Link to this heading">¶</a></h3>
<p>Both step doubling and embedded methods leave us with the difference between two different order solutions to the same step. Provided is a desired accuracy, <span class="math notranslate nohighlight">\(\Delta_{des}\)</span>. The way this accuracy is specified depends on the problem. It can be relative to the solution at step <span class="math notranslate nohighlight">\(i\)</span>,</p>
<div class="math notranslate nohighlight">
\[\Delta_{des}(i) = RTOL\cdot |y(i)|\]</div>
<p>where <span class="math notranslate nohighlight">\(RTOL\)</span> is the relative tolerance desired. An absolute part should be added to this so that the desired accuracy does not become zero. There are more ways to adjust the error specification to the problem, but the overall goal of the algorithm always is to make <span class="math notranslate nohighlight">\(\Delta_{est}(i)\)</span>, the estimated error for a step, satisfy</p>
<div class="math notranslate nohighlight">
\[|\Delta_{est}(i)|\leq\Delta_{des}(i)|\]</div>
<p>Note also that for a system of ODEs <span class="math notranslate nohighlight">\(\Delta_{des}\)</span> is of course a vector, and it is wise to replace the componentwise comparison by a vector norm.</p>
<p>Note now that the calculated error term is <span class="math notranslate nohighlight">\(O(h^{5})\)</span> as it was found as an error estimate to fourth-order Runge-Kutta methods. This makes it possible to scale the stepsize as</p>
<div id="eq:hnew"><p>eq:hnew</p>
</div><div class="math notranslate nohighlight">
\[h_{new} = h_{old}[{\Delta_{des}\over \Delta_{est}}]^{1/5}\]</div>
<p>or, to give an example of the suggested use of vector norms above, the new stepsize is given by</p>
<div id="eq:hnewnorm"><p>eq:hnewnorm</p>
</div><div class="math notranslate nohighlight">
\[h_{new} = S h_{old}\{[{1\over N}\sum_{i=1}^{N}({\Delta_{est}(i)\over \Delta_{des}(i)})^{2}]^{1/2}\}^{-1/5}\}\]</div>
<p>using the root-mean-square norm. <span class="math notranslate nohighlight">\(S\)</span> appears as a safety factor (<span class="math notranslate nohighlight">\(0&lt;S&lt;1\)</span>) to counteract the inaccuracy in the use of estimates.</p>
<p>The coefficients for the adaptive tolerances are set in adaptvars section of adapt.yaml:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">adaptvars</span><span class="p">:</span>
<span class="w">  </span><span class="nt">dtpassmin</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.1</span>
<span class="w">  </span><span class="nt">dtfailmax</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.5</span>
<span class="w">  </span><span class="nt">dtfailmin</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.1</span>
<span class="w">  </span><span class="nt">s</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.9</span>
<span class="w">  </span><span class="nt">rtol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1.0e-05</span>
<span class="w">  </span><span class="nt">atol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1.0e-05</span>
<span class="w">  </span><span class="nt">maxsteps</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2000.0</span>
<span class="w">  </span><span class="nt">maxfail</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">60.0</span>
<span class="w">  </span><span class="nt">dtpassmax</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5.0</span>
</pre></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Solve and plot for adaptive timestep</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>

<span class="n">theSolver</span> <span class="o">=</span> <span class="n">Integ54</span><span class="p">(</span><span class="s1">&#39;adapt.yaml&#39;</span><span class="p">)</span>
<span class="n">timeVals</span><span class="p">,</span> <span class="n">yVals</span><span class="p">,</span> <span class="n">errorList</span> <span class="o">=</span> <span class="n">theSolver</span><span class="o">.</span><span class="n">timeloop5Err</span><span class="p">()</span>

<span class="n">yvals</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_records</span><span class="p">(</span><span class="n">yVals</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="s1">&#39;black&#39;</span><span class="p">])</span>

<span class="n">thefig</span><span class="p">,</span> <span class="n">theAx</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

<span class="n">points</span><span class="p">,</span> <span class="o">=</span> <span class="n">theAx</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">timeVals</span><span class="p">,</span> <span class="n">yvals</span><span class="p">[</span><span class="s1">&#39;white&#39;</span><span class="p">],</span> <span class="s1">&#39;-b+&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;white daisies&#39;</span><span class="p">)</span>
<span class="n">points</span><span class="o">.</span><span class="n">set_markersize</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span>
<span class="n">theLine1</span><span class="p">,</span> <span class="o">=</span> <span class="n">theAx</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">timeVals</span><span class="p">,</span> <span class="n">yvals</span><span class="p">[</span><span class="s1">&#39;black&#39;</span><span class="p">],</span> <span class="s1">&#39;--ko&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;black daisies&#39;</span><span class="p">)</span>
<span class="n">theAx</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;lab 5 interactive 6&#39;</span><span class="p">)</span>
<span class="n">theAx</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">)</span>
<span class="n">theAx</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;fractional coverage&#39;</span><span class="p">)</span>
<span class="n">out</span> <span class="o">=</span> <span class="n">theAx</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">)</span>

<span class="c1"># timeVals,yVals,errorList=theSolver.timeloop5fixed()</span>
<span class="c1"># whiteDaisies=[frac[0] for frac in yVals]</span>
</pre></div>
</div>
</div>
<div id="prob_tolerances"></div><!-- {#lab5:sec:coding} --></section>
</section>
<section id="Coding-Runge-Kutta-Adaptive-Stepsize-Control">
<h2>Coding Runge-Kutta Adaptive Stepsize Control<a class="headerlink" href="#Coding-Runge-Kutta-Adaptive-Stepsize-Control" title="Link to this heading">¶</a></h2>
<p>The Runge-Kutta code developed in Lab 4 solves the given ODE system in fixed timesteps. It is now necessary to exert adaptive timestep control over the solution. The python code for this is at given in <a class="reference external" href="https://github.com/rhwhite/numeric_2024/blob/main/numlabs/lab5/lab5_funs.py#L145-L197">these lines.</a></p>
<p>In principle, this is pretty simple:</p>
<ol class="arabic simple">
<li><p>As before, take a step specified by the Runge-Kutta algorithm.</p></li>
<li><p>Determine whether the estimated error lies within the user specified tolerance</p></li>
<li><p>If the error is too large, calculate the new stepsize using the equations above, e.g. <span class="math notranslate nohighlight">\(h_{new} = S h_{old}\{[{1\over N}\sum_{i=1}^{N}({\Delta_{est}(i)\over \Delta_{des}(i)})^{2}]^{1/2}\}^{-1/5}\}\)</span> and retake the step.</p></li>
</ol>
<p>This can be accomplished by writing a new <a class="reference external" href="https://github.com/rhwhite/numeric_2024/blob/main/numlabs/lab5/lab5_funs.py#L115-L117">timeloop5Err</a> method which evaluates each Runge-Kutta step. This routine must now also return the estimate of the truncation error.</p>
<p>In practice, it is prudent to take a number of safeguards. This involves defining a number of variables that place limits on the change in stepsize:</p>
<ul class="simple">
<li><p>A safety factor (<span class="math notranslate nohighlight">\(0&lt;S&lt;1\)</span>) is used when a new step is calculated to further ensure that a small enough step is taken.</p></li>
<li><p>When a step fails, i.e. the error bound equation is not satisfied,</p>
<ul>
<li><p><em>dtfailmin</em>: The new step must change by some minimum factor.</p></li>
<li><p><em>dtfailmax</em>: The step cannot change by more than some maximum factor</p></li>
<li><p><em>maxattempts</em>: A limit is placed on the number of times a step is retried.</p></li>
<li><p>A check must be made to ensure that the new step is larger than machine roundoff. (Check if <span class="math notranslate nohighlight">\(t+dt == t\)</span>.)</p></li>
</ul>
</li>
<li><p>When a step passes, i.e. <span class="math notranslate nohighlight">\(|\Delta_{est}(i)|\leq\Delta_{des}(i)|\)</span> is satisfied,</p>
<ul>
<li><p><em>dtpassmin</em>: The step is not changed unless it is by some minimum factor.</p></li>
<li><p><em>dtpassmax</em>: The step is not changed by more than some maximum factor.</p></li>
</ul>
</li>
</ul>
<p>The only remaining question is what to take for the initial step. In theory, any step can be taken and the stepper will adjust the step accordingly. In practice, if the step is too far off, and the error is much larger than the given tolerance, the stepper will have difficulty. So some care must be taken in choosing the initial step.</p>
<p>Some safeguards can also be taken during the integration by defining,</p>
<ul class="simple">
<li><p><em>dtmin</em>: A limit placed on the smallest possible stepsize</p></li>
<li><p><em>maxsteps</em>: A limit placed on the total number of steps taken.</p></li>
</ul>
<p>The Python code for the the adaptive stepsize control is discussed further in Appendix Organization.</p>
<div id="prob_adaptive"></div><section id="Problem-adaptive">
<h3>Problem adaptive<a class="headerlink" href="#Problem-adaptive" title="Link to this heading">¶</a></h3>
<p>The demos in the previous section solved the Daisyworld equations using the embedded Runge-Kutta methods with adaptive timestep control.</p>
<ol class="arabic simple">
<li><p>Run the code and find solutions of Daisyworld with the default settings found in adapt.yaml using the timeloop5Err adaptive code</p></li>
<li><p>Find the solutions again but this time with fixed stepsizes (you can copy and paste code for this if you don’t want to code your own - be sure to read the earlier parts of the lab before attempting this question if you are stuck on how to do this!) and compare the solutions, the size of the timesteps, and the number of the timesteps between the fixed and adaptive timestep code.</p></li>
<li><p>Given the difference in the number of timesteps, how much faster would the fixed timeloop need to be to give the same performance as the adaptive timeloop for this case?</p></li>
</ol>
</section>
<section id="Daisyworld-Steady-States">
<h3>Daisyworld Steady States<a class="headerlink" href="#Daisyworld-Steady-States" title="Link to this heading">¶</a></h3>
<p>We can now use the Runge-Kutta code with adaptive timestep control to find some steady states of Daisyworld by varying the luminosity <span class="math notranslate nohighlight">\(LS_0\)</span> in the uservars section of adapt.yaml and recording the daisy fractions at the end of the integration. The code was used in the earlier sections to find some adhoc steady state solutions and the effect of altering some of the model parameters. What is of interest now is the effect of the daisy feedback on the range of parameter values for which
non-zero steady states exist. That the feedback does have an effect on the steady states was readily seen in Problem initial.</p>
<p>If we fix all other Daisyworld parameters, we find that non-zero steady states will exist for a range of solar luminosities which we characterize by the parameter L. Recall, that L is the multiple of the solar constant <span class="math notranslate nohighlight">\(S_0\)</span> that Daisyworld receives. What we will investigate in the next few sections is the effect of the daisy feedback on the range of L for which non-zero steady states can exist.</p>
<p>We accomplish this by fixing the Daisyworld parameters and finding the resulting steady state daisy population for a given value of L. A plot is then made of the steady-state daisy populations versus various values of L.</p>
</section>
<section id="Neutral-Daisies">
<h3>Neutral Daisies<a class="headerlink" href="#Neutral-Daisies" title="Link to this heading">¶</a></h3>
<p>The first case we consider is the case investigated in a previous demo where the albedo of the daisies and the ground are set to the same value. This means the daisy population has no effect on the planetary temperature, i.e. there is no feedback (Problem coupling).</p>
<p><span class="math notranslate nohighlight">\(~\)</span></p>
<p>Daisy fraction – daisies have ground albedo <img alt="b54029b0155140cba8eadbd7b9f4c22f" class="no-scaled-link" src="../../_images/steady_g.png" style="width: 40%;" /></p>
<p>Emission temperature <img alt="9179f7f8c7c54dcba366bdd6cc54642b" class="no-scaled-link" src="../../_images/temp_g.png" style="width: 40%;" /></p>
</section>
<section id="Black-Daisies">
<h3>Black Daisies<a class="headerlink" href="#Black-Daisies" title="Link to this heading">¶</a></h3>
<p>Now consider a population of black daisies. Note the sharp jump in the graph when the first non-zero daisy steady states appear and the corresponding rise in the planetary temperature. The appearance of the black daisies results in a strong positive feedback on the temperature. Note as well that the graph drops back to zero at a lower value of L than in the case of neutral daisies.</p>
<p>Daisies darker than ground <img alt="1fc213a5ea8e4c9591ab6c7165e0e221" class="no-scaled-link" src="../../_images/steady_b.png" style="width: 40%;" /></p>
<p>Temperature <img alt="218e55411bf649068510972f48c19ac3" class="no-scaled-link" src="../../_images/temp_b.png" style="width: 40%;" /></p>
</section>
<section id="White-Daisies">
<h3>White Daisies<a class="headerlink" href="#White-Daisies" title="Link to this heading">¶</a></h3>
<p>Consider now a population of purely white daisies. In this case there is an abrupt drop in the daisy steady state when it approaches zero with a corresponding jump in the emission temperature. Another interesting feature is the appearance of hysteresis (the dependence of the state of a system on its history). I.e. at an L of 1.4, there are two steady state solutions:</p>
<ol class="loweralpha simple">
<li><p>fractional coverage of white daisies of about 0.7, and an emission temperature of about 20C (look at the direction of the arrows on each plot to determine which emission temperature is linked to which fractional coverage)</p></li>
<li><p>no white daisies, and an emission temperature of about 55C.</p></li>
</ol>
<p>This hysteresis arises since the plot of steady states is different when solar luminosity is lowered as opposed to being raised incrementally. So which steady state the planet will be in will depend on the value of the solar constant before it was 1.4 - was it lower, in which case we’d be in state a (white daisies at about 0.7; see the arrows for direction); or was it higher (state b, no white daisies). This is what we mean when we say the state depends on its <em>history</em> - it matters what state
it was in before, even though we’re studying steady states.</p>
<p>Daisies brighter than ground <img alt="0866a867bda2462daa4e08988c95b7f3" class="no-scaled-link" src="../../_images/steady_w.png" style="width: 40%;" /></p>
<p>Temperature <img alt="95e7848dac2f42deb1be3f23d420b89a" class="no-scaled-link" src="../../_images/temp_w.png" style="width: 40%;" /></p>
</section>
<section id="Black-and-White-Daisies">
<h3>Black and White Daisies<a class="headerlink" href="#Black-and-White-Daisies" title="Link to this heading">¶</a></h3>
<p>Finally, consider a population of both black and white daisies. This blends in features from the cases where the daisy population was purely white or black. Note how the appearance of a white daisy population initially causes the planetary temperature to actually drop even though the solar luminosity has been increased.</p>
<p>fraction of black and white daisies <img alt="772312741e984ecb9cae1bcf6b08243b" class="no-scaled-link" src="../../_images/steady_bw.png" style="width: 40%;" /></p>
<p>note extended temperature range with stabilizing feedbacks <img alt="7de2a26ed7c64c458d46a7435976a7ca" class="no-scaled-link" src="../../_images/temp_bw.png" style="width: 40%;" /></p>
</section>
</section>
<section id="Conclusion">
<h2>Conclusion<a class="headerlink" href="#Conclusion" title="Link to this heading">¶</a></h2>
<p>Black daisies can survive at lower mean temperatures than the white daisies and the reverse is true for white daisies. The end result is that the range of L for which the non-zero daisy steady states exist is greater than the case of neutral (or no) daisies . In other words, the feedback from the daisies provide a stabilizing effect that extends the set of environmental conditions in which life on Daisyworld can exist.</p>
<section id="Problem-Predator">
<h3>Problem Predator<a class="headerlink" href="#Problem-Predator" title="Link to this heading">¶</a></h3>
<p>To make life a little more interesting on Daisyworld, add a population of rabbits that feed upon the daisies. The rabbit birth rate will be proportional to the area covered by the daisies while, conversely, the daisy <em>death rate</em> will be proportional to the rabbit population.</p>
<p>Add another equation to the Daisyworld model which governs the rabbit population and make the appropriate modifications to the existing daisy equations. Modify the set of equations and solve it with the Runge-Kutta method with adaptive timesteps. Use it to look for steady states and to determine their dependence on the initial conditions and model parameters.</p>
<p>Hand in notebook cells that:</p>
<ol class="arabic simple">
<li><p>Show your modified Daisyworld equations and your new integrator class.</p></li>
<li><p>At least one set of parameter values and initial conditions that leads to the steady state and a plot of the timeseries for the daisies and rabbits.</p></li>
<li><p>A discussion of the steady state’s dependence on these values, i.e. what happens when they are altered. Include a few plots for illustration.</p></li>
<li><p>Does adding this feedback extend the range of habital L values for which non-zero populations exist?</p></li>
</ol>
</section>
</section>
<section id="Appendix:-Note-on-Global-Energy-Balance">
<h2>Appendix: Note on Global Energy Balance<a class="headerlink" href="#Appendix:-Note-on-Global-Energy-Balance" title="Link to this heading">¶</a></h2>
<p>The statement that the earth is in energy balance follows from the First Law of Thermodynamics, i.e.</p>
<p><strong>The energy absorbed by an isolated system is equal to the change in the internal energy minus the work extracted</strong></p>
<p>which itself is an expression of the conservation of energy.</p>
<p>For the earth, the primary source of energy is radiation from the sun. The power emitted by the sun, known as the solar luminosity, is <span class="math notranslate nohighlight">\(L_0=3.9 \times 10^{26}W\)</span> while the energy flux received at the mean distance of the earth from the sun (<span class="math notranslate nohighlight">\(1.5\times 10^{11}m\)</span>) is called the solar constant, <span class="math notranslate nohighlight">\(S_0=1367\ W m^{-2}\)</span>. For Daisy World the solar constant is taken to be <span class="math notranslate nohighlight">\(S_0=3668\ W m^{-2}\)</span>.</p>
<p>The emission temperature of a planet is the temperature the planet would be at if it emitted energy like a blackbody. A blackbody, so-called because it is a perfect absorber of radiation, obeys the Stefan-Boltzmann Law:</p>
<!-- \label{lab5:stefan-boltzmann-law} --><p><span class="math">\textbf{eq: Stefan-Boltzman}</span></p>
<div class="math notranslate nohighlight">
\[F_B\ (Wm^{-2}) = \sigma T^4_e\]</div>
<p>where <span class="math notranslate nohighlight">\(\epsilon\)</span> is the energy density and <span class="math notranslate nohighlight">\(\sigma = 5.67\times 10^{-8}Wm^{-2}K^{-4}\)</span>. Given the energy absorbed, it is easy to calculate the emission temperature <span class="math notranslate nohighlight">\(T_e\)</span> with Stefan-Boltzman equation.</p>
<p>In general, a planet will reflect some of the radiation it receives, with the fraction reflected known as the albedo <span class="math notranslate nohighlight">\(\alpha_p\)</span>. So the total energy absorbed by the planet is actually flux density received times the fraction absorbed times the perpendicular area to the sun ( the ’shadow area’), i.e.</p>
<!-- \label{lab5:energyabsorbed} --><div class="math notranslate nohighlight">
\[E_{\rm absorbed}=S_0(1-\alpha_p)\pi r_p^2\]</div>
<p>where <span class="math notranslate nohighlight">\(r^2_p\)</span> is the planet’s radius.</p>
<p>If we still assume the planet emits like a blackbody, we can calculate the corresponding blackbody emission temperature. The total power emitted would be the flux <span class="math notranslate nohighlight">\(F_B\)</span> of the blackbody times its surface area, i.e.</p>
<!-- \label{lab5:energyemitted} --><div class="math notranslate nohighlight">
\[E_{\rm blackbody} = \sigma T^4_e 4\pi  r_p^2\]</div>
<p>Equating the energy absorbed with the energy emitted by a blackbody we can calculate the emission temperature,</p>
<!-- \label{lab5:emissiontemp} --><div class="math notranslate nohighlight">
\[T^4_e = L \frac{S_0}{4\sigma}(1-\alpha_p)\]</div>
</section>
<section id="Summary:-Daisy-World-Equations">
<h2>Summary: Daisy World Equations<a class="headerlink" href="#Summary:-Daisy-World-Equations" title="Link to this heading">¶</a></h2>
<div class="math notranslate nohighlight">
\[\frac{dA_w}{dt} = A_w ( \beta_w x - \chi)\]</div>
<div class="math notranslate nohighlight">
\[\frac{dA_b}{dt} = A_b ( \beta_b x - \chi)\]</div>
<div class="math notranslate nohighlight">
\[x = 1 - A_w - A_b\]</div>
<div class="math notranslate nohighlight">
\[\beta_i = 1.0 - 0.003265(295.5 K -T_i)^2\]</div>
<div class="math notranslate nohighlight">
\[T^4_i = R L \frac{S_0}{4\sigma}(\alpha_p-\alpha_i) + T^4_e\]</div>
<div class="math notranslate nohighlight">
\[\alpha_p = A_w\alpha_w + A_b\alpha_b + A_g\alpha_g\]</div>
<div class="math notranslate nohighlight">
\[T^4_e = L \frac{S_0}{4\sigma}(1-\alpha_p)\]</div>
<div id="code_org"></section>
<section id="Appendix:-Organization-of-the-adaptive-Runge-Kutta-routines">
<h2>Appendix: Organization of the adaptive Runge Kutta routines<a class="headerlink" href="#Appendix:-Organization-of-the-adaptive-Runge-Kutta-routines" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p>The coding follows <a class="reference external" href="adapt_ode.pdf">Press et al.</a>, with the adaptive Runge Kutta defined in the Integrator base class <a class="reference external" href="https://github.com/rhwhite/numeric_2022/blob/main/numlabs/lab5/lab5_funs.py#L43-L59">here</a></p></li>
<li><p>The step size choice is made in <a class="reference external" href="https://github.com/rhwhite/numeric_2022/blob/main/numlabs/lab5/lab5_funs.py#L115-L118">timeloop5err</a></p></li>
<li><p>To set up a specific problem, you need to overide two methods as demonstrated in the example code: the member function that initalizes the concentrations: <a class="reference external" href="https://github.com/rhwhite/numeric_2022/blob/main/numlabs/lab5/lab5_funs.py#L115-L118">yinit</a> and the derivatives routine <a class="reference external" href="https://github.com/rhwhite/numeric_2022/blob/main/numlabs/lab5/lab5_funs.py#L66-L68">derivs5</a></p></li>
<li><p>In Problem Initial we define a new member function:</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">find_temp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">yvals</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Calculate the temperatures over the white and black daisies</span>
<span class="sd">            and the planetary equilibrium temperature given the daisy fractions</span>

<span class="sd">            input:  yvals -- array of dimension [2] with the white [0] and black [1]</span>
<span class="sd">                    daisy fraction</span>
<span class="sd">            output:  white temperature (K), black temperature (K), equilibrium temperature (K)</span>
<span class="sd">        &quot;&quot;&quot;</span>
</pre></div>
</div>
<p>which give an example of how to use the instance variable data (self.uservars) in additional calculations.</p>
</section>
<section id="Appendix:-2-minute-intro-to-object-oriented-programming">
<h2>Appendix: 2 minute intro to object oriented programming<a class="headerlink" href="#Appendix:-2-minute-intro-to-object-oriented-programming" title="Link to this heading">¶</a></h2>
<p>For a very brief introduction to python classes take a look at <a class="reference external" href="http://www.scipy-lectures.org/intro/language/oop.html">these scipy lecture notes</a> that define some of the basic concepts. For perhaps more detail than you want/need to know, see this 2 part series on <a class="reference external" href="https://realpython.com/python3-object-oriented-programming">object oriented programming</a> and inheritence (<a class="reference external" href="https://realpython.com/python-super/">supercharge your classes with super()</a>) Briefly, we need a way to store a lot of
information, for example the Runge-Kutta coefficients, in an organized way that is accessible to multiple functions, without having to pass all that information through the function arguments. Python solves this problem by putting both the data and the functions together into an class, as in the Integrator class below.</p>
<section id="Classes-and-constructors">
<h3>Classes and constructors<a class="headerlink" href="#Classes-and-constructors" title="Link to this heading">¶</a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">Integrator</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">first</span><span class="p">,</span> <span class="n">second</span><span class="p">,</span> <span class="n">third</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Constructing Integrator&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">a</span> <span class="o">=</span> <span class="n">first</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">b</span> <span class="o">=</span> <span class="n">second</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="o">=</span> <span class="n">third</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">dumpit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">the_name</span><span class="p">):</span>
        <span class="n">printlist</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="p">]</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;dumping arguments for </span><span class="si">{</span><span class="n">the_name</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">printlist</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">__init__()</span></code> is called the class constructor</p></li>
<li><p>a,b,c are called class attributes</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">dumpit()</span></code> is called a member function or method</p></li>
<li><p>We construct and instance of the class by passing the required arguments to <code class="docutils literal notranslate"><span class="pre">__init__</span></code></p></li>
</ul>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">the_integ</span> <span class="o">=</span> <span class="n">Integrator</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">dir</span><span class="p">(</span><span class="n">the_integ</span><span class="p">))</span>
<span class="c1">#note that the_integ now has a, b, c, and dumpit</span>
</pre></div>
</div>
</div>
<ul class="simple">
<li><p>and we call the member function like this:</p></li>
</ul>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">the_integ</span><span class="o">.</span><span class="n">dumpit</span><span class="p">(</span><span class="s1">&#39;Demo object&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>What does this buy us? Member functions only need arguments specific to them, and can use any attribute or other member function attached to the self variable, which doesn’t need to be part of the function call.</p>
</section>
<section id="finding-the-attributes-and-methods-of-a-class-instance">
<h3>finding the attributes and methods of a class instance<a class="headerlink" href="#finding-the-attributes-and-methods-of-a-class-instance" title="Link to this heading">¶</a></h3>
<p>Python has a couple of functions that allow you to see the methods and attributes of objects</p>
<p>To get a complete listing of builtin and user-defined methods and attributes use</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>dir
</pre></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">dir</span><span class="p">(</span><span class="n">the_integ</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>To see just the attributes, use</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>vars
</pre></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">vars</span><span class="p">(</span><span class="n">the_integ</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>The inspect.getmembers function gives you everything as a list of (name,object) tuples so you can filter the items you’re interested in. See:</p>
<p><a class="reference external" href="https://docs.python.org/3/library/inspect.html">https://docs.python.org/3/library/inspect.html</a></p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">inspect</span>
<span class="n">all_info_the_integ</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">getmembers</span><span class="p">(</span><span class="n">the_integ</span><span class="p">)</span>
<span class="n">only_methods</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">all_info_the_integ</span> <span class="k">if</span> <span class="n">inspect</span><span class="o">.</span><span class="n">ismethod</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;methods for the_integ: &#39;</span><span class="p">,</span> <span class="n">only_methods</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
<section id="Inheritance">
<h3>Inheritance<a class="headerlink" href="#Inheritance" title="Link to this heading">¶</a></h3>
<p>We can also specialize a class by driving from a base and then adding more data or members, or overriding existing values. For example:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="k">class</span><span class="w"> </span><span class="nc">Trig</span><span class="p">(</span><span class="n">Integrator</span><span class="p">):</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">one</span><span class="p">,</span> <span class="n">two</span><span class="p">,</span> <span class="n">three</span><span class="p">,</span> <span class="n">four</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;constructing Trig&#39;</span><span class="p">)</span>
        <span class="c1">#</span>
        <span class="c1"># first construct the base class</span>
        <span class="c1">#</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">one</span><span class="p">,</span> <span class="n">two</span><span class="p">,</span> <span class="n">three</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">d</span> <span class="o">=</span> <span class="n">four</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">calc_trig</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trigval</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">print_trig</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">the_date</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;on </span><span class="si">{</span><span class="n">the_date</span><span class="si">}</span><span class="s1"> the value of sin(a*b)=: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">trigval</span><span class="si">:</span><span class="s1">5.3f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<br/><br/></pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sample</span> <span class="o">=</span> <span class="n">Trig</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="n">sample</span><span class="o">.</span><span class="n">calc_trig</span><span class="p">()</span>
<span class="n">sample</span><span class="o">.</span><span class="n">print_trig</span><span class="p">(</span><span class="s1">&#39;July 5&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
<section id="Initializing-using-yaml">
<h3>Initializing using yaml<a class="headerlink" href="#Initializing-using-yaml" title="Link to this heading">¶</a></h3>
<p>To specify the intial values for the class, we use a plain text format called <a class="reference external" href="http://www.yaml.org/spec/1.2/spec.html">yaml</a>. To write a yaml file, start with a dictionary that contains entries that are themselves dictionaries:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">yaml</span>
<span class="n">out_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
<span class="n">out_dict</span><span class="p">[</span><span class="s1">&#39;vegetables&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">carrots</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">eggplant</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span> <span class="n">corn</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">out_dict</span><span class="p">[</span><span class="s1">&#39;fruit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">apples</span><span class="o">=</span><span class="s1">&#39;Out of season&#39;</span><span class="p">,</span> <span class="n">strawberries</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;groceries.yaml&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">yaml</span><span class="o">.</span><span class="n">safe_dump</span><span class="p">(</span><span class="n">out_dict</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#what&#39;s in the yaml file?</span>
<span class="c1">#each toplevel dictionary key became a category</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>  <span class="c1">#output to sys.stdout because print adds blank lines</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;groceries.yaml&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">():</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#read into a dictionary</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;groceries.yaml&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">init_dict</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">init_dict</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div id="sec_override"></section>
<section id="Overriding-initial-values-in-a-derived-class">
<h3>Overriding initial values in a derived class<a class="headerlink" href="#Overriding-initial-values-in-a-derived-class" title="Link to this heading">¶</a></h3>
<p>Suppose we want to change a value like the strength of the sun, <span class="math notranslate nohighlight">\(L\)</span>, after it’s been read in from the initail yaml file? Since a derived class can override the yinit function in the Integrator class, we are free to change it to overwrite any variable by reassigning the new value to self in the child constructor.</p>
<p>Here’s a simple example showing this kind of reinitialization:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>


<span class="k">class</span><span class="w"> </span><span class="nc">Base</span><span class="p">:</span>
    <span class="c1">#</span>
    <span class="c1"># this constructor is called first</span>
    <span class="c1">#</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">basevar</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">L</span> <span class="o">=</span> <span class="n">basevar</span>


<span class="k">class</span><span class="w"> </span><span class="nc">Child</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="c1">#</span>
    <span class="c1"># this class changes the initialization</span>
    <span class="c1"># to add a new variable</span>
    <span class="c1">#</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">L</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
        <span class="c1">#</span>
        <span class="c1"># change the L in the child class</span>
        <span class="c1">#</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">L</span> <span class="o">=</span> <span class="n">L</span>
</pre></div>
</div>
</div>
<p>Now we can use Child(a,Lval) to construct instances with any value of L we want:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Lvals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">11</span><span class="p">)</span>

<span class="c1">#</span>
<span class="c1"># now make 10 children, each with a different value of L</span>
<span class="c1">#</span>
<span class="n">a</span> <span class="o">=</span> <span class="mi">5</span>
<span class="k">for</span> <span class="n">theL</span> <span class="ow">in</span> <span class="n">Lvals</span><span class="p">:</span>
    <span class="n">newItem</span> <span class="o">=</span> <span class="n">Child</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">theL</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;set L value in child class to </span><span class="si">{</span><span class="n">newItem</span><span class="o">.</span><span class="n">L</span><span class="si">:</span><span class="s1">3.0f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>To change L in the IntegCoupling class in Problem Conduction look at changing the value above these lines:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">initvars</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s1">&#39;initvars&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;initvars&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
<span class="bp">self</span><span class="o">.</span><span class="n">initvars</span> <span class="o">=</span> <span class="n">initvars</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;initvars&#39;</span><span class="p">])</span>
</pre></div>
</div>
</section>
<section id="Specific-example">
<h3>Specific example<a class="headerlink" href="#Specific-example" title="Link to this heading">¶</a></h3>
<p>So to use this technique for Problem Conduction, override <code class="docutils literal notranslate"><span class="pre">set_yinit</span></code> so that it will take a new luminosity value newL, and add it to uservars, like this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">IntegCoupling</span><span class="p">(</span><span class="n">Integrator</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;rewrite the set_yinit method</span>
<span class="sd">       to work with luminosity</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">set_yinit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">newL</span><span class="p">):</span>
        <span class="c1">#</span>
        <span class="c1"># change the luminocity</span>
        <span class="c1">#</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;uservars&quot;</span><span class="p">][</span><span class="s2">&quot;L&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">newL</span> <span class="c1"># change solar incidence fraction</span>
        <span class="c1">#</span>
        <span class="c1"># make a new namedtuple factory called uservars that includes newL</span>
        <span class="c1">#</span>
        <span class="n">uservars_fac</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s1">&#39;uservars&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;uservars&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="c1">#</span>
        <span class="c1"># use the factory to make the augmented uservars named tuple</span>
        <span class="c1">#</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">uservars</span> <span class="o">=</span> <span class="n">uservars_fac</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;uservars&#39;</span><span class="p">])</span>
        <span class="c1">#</span>


    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">coeffFileName</span><span class="p">,</span> <span class="n">newL</span><span class="p">):</span>
       <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">coeffFileName</span><span class="p">)</span>
       <span class="bp">self</span><span class="o">.</span><span class="n">set_yinit</span><span class="p">(</span><span class="n">newL</span><span class="p">)</span>

    <span class="o">...</span>
</pre></div>
</div>
<p>then construct a new instance with a value of newL like this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">theSolver</span> <span class="o">=</span> <span class="n">IntegCoupling</span><span class="p">(</span><span class="s2">&quot;coupling.yaml&quot;</span><span class="p">,</span> <span class="n">newL</span><span class="p">)</span>
</pre></div>
</div>
<p>The IntegCoupling constructor first constructs an instance of the Integrator class by calling <code class="docutils literal notranslate"><span class="pre">super()</span></code> and passing it the name of the yaml file. Once this is done then it calls the <code class="docutils literal notranslate"><span class="pre">IntegCoupling.set_yinit</span></code> method which takes the Integrator class instance (called “self” by convention) and modifies it by adding newL to the usersvars attribute.</p>
<p>Try executing</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">newL</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">theSolver</span> <span class="o">=</span> <span class="n">IntegCoupling</span><span class="p">(</span><span class="s2">&quot;coupling.yaml&quot;</span><span class="p">,</span> <span class="n">newL</span><span class="p">)</span>
</pre></div>
</div>
<p>and verify that:</p>
<p><code class="docutils literal notranslate"><span class="pre">theSolver.uservars.L</span></code> is indeed 50</p>
<section id="Check-your-understanding">
<h4>Check your understanding<a class="headerlink" href="#Check-your-understanding" title="Link to this heading">¶</a></h4>
<p>To see if you’re really getting the zeitgeist, try an alternative design where you leave the constructor as is, and instead add a new method called:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">reset_L</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">newL</span><span class="p">)</span>
</pre></div>
</div>
<p>so that you could do this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">newL</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">theSolver</span> <span class="o">=</span> <span class="n">IntegCoupling</span><span class="p">(</span><span class="s2">&quot;coupling.yaml&quot;</span><span class="p">)</span>
<span class="n">theSolver</span><span class="o">.</span><span class="n">reset_L</span><span class="p">(</span><span class="n">newL</span><span class="p">)</span>
</pre></div>
</div>
<p>and get <code class="docutils literal notranslate"><span class="pre">theSolver.uservars.L</span></code> set to 50.</p>
</section>
</section>
<section id="Why-bother?">
<h3>Why bother?<a class="headerlink" href="#Why-bother?" title="Link to this heading">¶</a></h3>
<p>What does object oriented programming buy us? The dream was that companies/coders could ship standard base classes, thoroughly tested and documented, and then users could adapt those classes to their special needs using inheritence. This turned out to be too ambitous, but a dialed-back version of this is definitely now part of many major programming languages.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
</section>
</section>
</section>


      </div>
    </div>
  </div>
      <div class="clearer"></div>
    </div>
  

   
    <div class="footer" role="contentinfo">
    &#169; Copyright 1995 – present.
      Last updated on 20-Jan-2025.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 8.1.3.
    </div> <script src="//www.mozilla.org/tabzilla/media/js/tabzilla.js"></script> 
  <!-- remove loading of Mozilla tabzilla.js script -->

  </body>
</html>